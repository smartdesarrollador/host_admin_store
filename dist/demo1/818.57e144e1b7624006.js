"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[818],{3818:(H,_,r)=>{r.r(_),r.d(_,{RoleModule:()=>j});var d=r(6814),e=r(5879),h=r(4468),g=r(1274),c=r(6223),f=r(7304),v=r(5722);const b=["formModal"],C=["noticeSwal"];function Z(n,a){if(1&n&&(e.ynx(0),e.TgZ(1,"div",23),e._UZ(2,"span",24),e._uU(3),e.ALo(4,"titlecase"),e.qZA(),e.BQk()),2&n){const t=a.$implicit;e.xp6(3),e.hij("",e.lcZ(4,1,t.name)," ")}}function y(n,a){if(1&n&&(e.TgZ(0,"div",23),e._UZ(1,"span",24),e.TgZ(2,"em"),e._uU(3),e.qZA()()),2&n){const t=e.oxw().$implicit;e.xp6(3),e.hij(" ",0===t.permissions.length?"No permissions given...":"and "+(t.permissions.length-5)+" more..."," ")}}const T=function(n){return["/apps/roles",n]};function w(n,a){if(1&n&&(e.ynx(0),e.TgZ(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15)(5,"h2"),e._uU(6),e.ALo(7,"titlecase"),e.qZA()()(),e.TgZ(8,"div",16)(9,"div",17),e._uU(10),e.qZA(),e.TgZ(11,"div",18),e.YNc(12,Z,5,3,"ng-container",11),e.YNc(13,y,4,1,"div",19),e.qZA()(),e.TgZ(14,"div",20)(15,"a",21),e._uU(16,"View Role"),e.qZA(),e.TgZ(17,"button",22),e._uU(18,"Edit Role"),e.qZA()()()(),e.BQk()),2&n){const t=a.$implicit;e.xp6(6),e.Oqu(e.lcZ(7,6,t.name)),e.xp6(4),e.hij("Total users with this role: ",t.users.length,""),e.xp6(2),e.Q6J("ngForOf",t.permissions.slice(0,5)),e.xp6(1),e.Q6J("ngIf",t.permissions.length>5||0===t.permissions.length),e.xp6(2),e.Q6J("routerLink",e.VKq(8,T,t.id)),e.xp6(2),e.uIk("data-id",t.id)}}function A(n,a){if(1&n&&(e.ynx(0),e.YNc(1,w,19,10,"ng-container",11),e.BQk()),2&n){const t=a.ngIf;e.xp6(1),e.Q6J("ngForOf",t.data)}}function R(n,a){1&n&&(e.TgZ(0,"div"),e._uU(1,"Role name is required"),e.qZA())}function M(n,a){1&n&&(e.TgZ(0,"div"),e._uU(1,"Role name must be at least 4 characters long"),e.qZA())}function k(n,a){if(1&n&&(e.TgZ(0,"div",48),e.YNc(1,R,2,0,"div",1),e.YNc(2,M,2,0,"div",1),e.qZA()),2&n){e.oxw();const t=e.MAs(18);e.xp6(1),e.Q6J("ngIf",null==t.errors?null:t.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.errors?null:t.errors.minlength)}}const S=function(n){return{"ki-up":n}};function U(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"form",25,26),e.NdJ("ngSubmit",function(o){e.CHM(t);const s=e.MAs(1),l=e.oxw();return e.KtG(l.onSubmit(o,s))}),e.TgZ(2,"div",27)(3,"h4",28),e._uU(4,"Role Details"),e.qZA(),e.TgZ(5,"button",29),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.dismiss("Cross click"))}),e.qZA()(),e.TgZ(6,"div",30)(7,"div",31)(8,"div",32),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(13);return e.KtG(o.toggle())}),e._uU(9,"User Information "),e.TgZ(10,"span",33),e._UZ(11,"i",34),e.qZA()(),e.TgZ(12,"div",35,36),e.NdJ("ngbCollapseChange",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.isCollapsed1=o)}),e.TgZ(14,"div",37)(15,"label",38),e._uU(16,"Role Name"),e.qZA(),e.TgZ(17,"input",39,40),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.roleModel.name=o)}),e.qZA(),e.YNc(19,k,3,2,"div",41),e.qZA()()()(),e.TgZ(20,"div",42)(21,"button",43),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.dismiss("cancel"))}),e._uU(22," Discard "),e.qZA(),e.TgZ(23,"button",44)(24,"span",45),e._uU(25," Submit "),e.qZA(),e.TgZ(26,"span",46),e._uU(27," Please wait... "),e._UZ(28,"span",47),e.qZA()()()()}if(2&n){const t=e.MAs(1),i=e.oxw();e.xp6(8),e.uIk("aria-expanded",!i.isCollapsed1),e.xp6(3),e.Q6J("ngClass",e.VKq(6,S,!i.isCollapsed1)),e.xp6(1),e.Q6J("ngbCollapse",i.isCollapsed1),e.xp6(5),e.Q6J("ngModel",i.roleModel.name),e.xp6(2),e.Q6J("ngIf",t.submitted&&t.invalid),e.xp6(4),e.uIk("data-kt-indicator",i.isLoading?"on":"off")}}let L=(()=>{class n{apiService;cdr;renderer;modalService;isCollapsed1=!1;isLoading=!1;roles$;reloadEvent=new e.vpe;role$;roleModel={id:0,name:"",permissions:[],users:[]};formModal;noticeSwal;swalOptions={};modalConfig={modalDialogClass:"modal-dialog modal-dialog-centered mw-650px"};clickListener;constructor(t,i,o,s){this.apiService=t,this.cdr=i,this.renderer=o,this.modalService=s}ngAfterViewInit(){this.clickListener=this.renderer.listen(document,"click",t=>{const i=t.target.closest(".btn");if(i){const{action:o,id:s}=i.dataset;switch(o){case"view":case"delete":break;case"create":this.create(),this.modalService.open(this.formModal,this.modalConfig);break;case"edit":this.edit(s),this.modalService.open(this.formModal,this.modalConfig)}}})}ngOnInit(){this.roles$=this.apiService.getRoles()}delete(t){this.apiService.deleteRole(t).subscribe(()=>{})}edit(t){this.role$=this.apiService.getRole(t),this.role$.subscribe(i=>{this.roleModel=i})}create(){this.roleModel={id:0,name:"",permissions:[],users:[]}}onSubmit(t,i){if(i&&i.invalid)return;this.isLoading=!0;const o={icon:"success",title:"Success!",text:this.roleModel.id>0?"User updated successfully!":"User created successfully!"},s={icon:"error",title:"Error!",text:""},l=()=>{this.isLoading=!1,this.modalService.dismissAll(),this.roles$=this.apiService.getRoles(),this.cdr.detectChanges()};this.roleModel.id>0?(()=>{this.apiService.updateRole(this.roleModel.id,this.roleModel).subscribe({next:()=>{this.showAlert(o),this.reloadEvent.emit(!0)},error:u=>{s.text=this.extractText(u.error),this.showAlert(s),this.isLoading=!1},complete:l})})():(()=>{this.apiService.createRole(this.roleModel).subscribe({next:()=>{this.showAlert(o),this.reloadEvent.emit(!0)},error:u=>{s.text=this.extractText(u.error),this.showAlert(s),this.isLoading=!1},complete:l})})()}extractText(t){var i=[];for(var o in t)"string"==typeof t[o]?i.push(t[o]):"object"==typeof t[o]&&(i=i.concat(this.extractText(t[o])));return Array.from(new Set(i)).join("\n")}showAlert(t){let i=t.icon?.toString()||"success";"error"===t.icon&&(i="danger"),this.swalOptions=Object.assign({buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-"+i}},t),this.cdr.detectChanges(),this.noticeSwal.fire()}ngOnDestroy(){this.clickListener&&this.clickListener(),this.modalService.dismissAll()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.N),e.Y36(e.sBO),e.Y36(e.Qsj),e.Y36(g.FF))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-role-listing"]],viewQuery:function(i,o){if(1&i&&(e.Gf(b,5),e.Gf(C,5)),2&i){let s;e.iGM(s=e.CRH())&&(o.formModal=s.first),e.iGM(s=e.CRH())&&(o.noticeSwal=s.first)}},decls:14,vars:4,consts:[[1,"row","row-cols-1","row-cols-md-2","row-cols-xl-3","g-5","g-xl-9"],[4,"ngIf"],[1,"ol-md-4"],[1,"card","h-md-100"],[1,"card-body","d-flex","flex-center"],["type","button","data-action","create",1,"btn","btn-clear","d-flex","flex-column","flex-center"],["src","assets/media/illustrations/sketchy-1/4.png","alt","",1,"mw-100","mh-150px","mb-7"],[1,"fw-bold","fs-3","text-gray-600","text-hover-primary"],[3,"swalOptions"],["noticeSwal",""],["formModal",""],[4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"card","card-flush","h-md-100"],[1,"card-header"],[1,"card-title"],[1,"card-body","pt-1"],[1,"fw-bold","text-gray-600","mb-5"],[1,"d-flex","flex-column","text-gray-600"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"card-footer","flex-wrap","pt-0"],[1,"btn","btn-light","btn-active-primary","my-1","me-2",3,"routerLink"],["type","button","data-action","edit",1,"btn","btn-light","btn-active-light-primary","my-1"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"],[3,"ngSubmit"],["myForm","ngForm"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["id","kt_modal_update_customer_scroll","data-kt-scroll","true","data-kt-scroll-activate","{default: false, lg: true}","data-kt-scroll-max-height","auto","data-kt-scroll-dependencies","#kt_modal_update_customer_header","data-kt-scroll-wrappers","#kt_modal_update_customer_scroll","data-kt-scroll-offset","300px",1,"d-flex","flex-column","scroll-y","me-n7","pe-7","mw-650px"],["data-bs-toggle","collapse","role","button","aria-controls","kt_modal_update_customer_user_info",1,"fw-bold","fs-3","rotate","collapsible","mb-7",3,"click"],[1,"ms-2","rotate-180"],[1,"ki-duotone","ki-down","fs-3",3,"ngClass"],[1,"collapse","show",3,"ngbCollapse","ngbCollapseChange"],["collapse1","ngbCollapse"],[1,"fv-row","mb-7"],[1,"required","fw-semibold","fs-6","mb-2"],["type","text","name","name","required","","minlength","4",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],["name","ngModel"],["class","fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback",4,"ngIf"],[1,"modal-footer","flex-center"],["type","reset","id","kt_modal_update_customer_cancel",1,"btn","btn-light","me-3",3,"click"],["type","submit","id","kt_modal_update_customer_submit",1,"btn","btn-primary"],[1,"indicator-label"],[1,"indicator-progress"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"],[1,"fv-plugins-message-container","fv-plugins-message-container--enabled","invalid-feedback"]],template:function(i,o){1&i&&(e.TgZ(0,"div",0),e.YNc(1,A,2,1,"ng-container",1),e.ALo(2,"async"),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"button",5),e._UZ(7,"img",6),e.TgZ(8,"div",7),e._uU(9,"Add New Role"),e.qZA()()()()()(),e._UZ(10,"swal",8,9),e.YNc(12,U,29,8,"ng-template",null,10,e.W1O)),2&i&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.roles$)),e.xp6(9),e.Q6J("swalOptions",o.swalOptions))},dependencies:[d.mk,d.sg,d.O5,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.wO,c.On,c.F,f.rH,g._D,v.q1,d.Ov,d.rS]})}return n})();var J=r(6676),x=r.n(J),N=r(431);function Q(n,a){if(1&n&&(e.TgZ(0,"div",19),e._UZ(1,"span",20),e._uU(2),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.name," ")}}function q(n,a){if(1&n&&(e.TgZ(0,"div",19),e._UZ(1,"span",20),e.TgZ(2,"em"),e._uU(3),e.qZA()()),2&n){const t=e.oxw(2).ngIf;e.xp6(3),e.hij("and ",t.permissions.length-5," more...")}}function I(n,a){if(1&n&&(e.ynx(0),e.YNc(1,Q,3,1,"div",18),e.YNc(2,q,4,1,"div",18),e.BQk()),2&n){const t=a.index,i=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",t<5),e.xp6(1),e.Q6J("ngIf",5===t&&(null==i.permissions?null:i.permissions.length)&&i.permissions.length>5)}}function Y(n,a){if(1&n&&(e.ynx(0),e.YNc(1,I,3,2,"ng-container",17),e.BQk()),2&n){const t=a.ngIf;e.xp6(1),e.Q6J("ngForOf",t.permissions)}}function O(n,a){if(1&n&&(e.ynx(0),e.TgZ(1,"span",21),e._uU(2),e.qZA(),e.BQk()),2&n){const t=a.ngIf;e.xp6(2),e.hij("(",t.users.length,")")}}let F=(()=>{class n{route;apiService;role$;datatableConfig={};reloadEvent=new e.vpe;constructor(t,i){this.route=t,this.apiService=i}ngOnInit(){this.route.params.subscribe(t=>{const i=t.id;this.role$=this.apiService.getRole(i),this.datatableConfig={serverSide:!0,ajax:(o,s)=>{this.apiService.getUsers(i,o).subscribe(l=>{console.log(l),s(l)})},columns:[{title:"Name",data:"name",render:function(o,s,l){const m=["success","info","warning","danger"],p=m[Math.floor(Math.random()*m.length)],u=o[0].toUpperCase();return`\n              <div class="symbol symbol-circle symbol-50px overflow-hidden me-3" data-action="view" data-id="${l.id}">\n                <a href="javascript:;">\n                  \n              <div class="symbol-label fs-3 bg-light-${p} text-${p}">\n                ${u}\n              </div>\n            \n                </a>\n              </div>\n              \n              <div class="d-flex flex-column" data-action="view" data-id="${l.id}">\n                <a href="javascript:;" class="text-gray-800 text-hover-primary mb-1">${o}</a>\n                <span>${l.email}</span>\n              </div>\n            \n            `}},{title:"Role",data:"role",render:function(o,s,l){return l.roles[0]?.name||""},orderData:[1],orderSequence:["asc","desc"],type:"string"},{title:"Last Login",data:"last_login_at",render:(o,s,l)=>{const m=o||l.created_at;return`<div class="badge badge-light fw-bold">${x()(m).fromNow()}</div>`}},{title:"Joined Date",data:"created_at",render:function(o){return x()(o).format("DD MMM YYYY, hh:mm a")}}],createdRow:function(o,s,l){$("td:eq(0)",o).addClass("d-flex align-items-center")}}})}deleteUser(t){this.route.params.subscribe(i=>{this.apiService.deleteUser(i.id,t).subscribe(()=>{this.reloadEvent.emit(!0)})})}static \u0275fac=function(i){return new(i||n)(e.Y36(f.gz),e.Y36(h.N))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-role-details"]],decls:26,vars:11,consts:[[1,"d-flex","flex-column","flex-lg-row"],[1,"flex-column","flex-lg-row-auto","w-100","w-lg-200px","w-xl-300px","mb-10"],[1,"card","card-flush"],[1,"card-header"],[1,"card-title"],[1,"mb-0"],[1,"card-body","pt-0"],[1,"d-flex","flex-column","text-gray-600"],[4,"ngIf"],[1,"card-footer","pt-0"],["type","button","data-role-id","developer","data-bs-toggle","modal","data-bs-target","#kt_modal_update_role",1,"btn","btn-light","btn-active-primary"],[1,"flex-lg-row-fluid","ms-lg-10"],[1,"card","card-flush","mb-6","mb-xl-9"],[1,"card-header","pt-5"],[1,"d-flex","align-items-center"],[1,"card-toolbar"],[3,"datatableConfig","reload","deleteEvent"],[4,"ngFor","ngForOf"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"],[1,"text-gray-600","fs-6","ms-1"]],template:function(i,o){if(1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e._uU(6),e.ALo(7,"async"),e.qZA()()(),e.TgZ(8,"div",6)(9,"div",7),e.YNc(10,Y,2,1,"ng-container",8),e.ALo(11,"async"),e.qZA()(),e.TgZ(12,"div",9)(13,"button",10),e._uU(14,"Edit Role"),e.qZA()()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",4)(19,"h2",14),e._uU(20,"Users Assigned "),e.YNc(21,O,3,1,"ng-container",8),e.ALo(22,"async"),e.qZA()(),e._UZ(23,"div",15),e.qZA(),e.TgZ(24,"div",6)(25,"app-crud",16),e.NdJ("deleteEvent",function(l){return o.deleteUser(l)}),e.qZA()()()()()),2&i){let s;e.xp6(6),e.hij(" ",null==(s=e.lcZ(7,5,o.role$))?null:s.name," "),e.xp6(4),e.Q6J("ngIf",e.lcZ(11,7,o.role$)),e.xp6(11),e.Q6J("ngIf",e.lcZ(22,9,o.role$)),e.xp6(4),e.Q6J("datatableConfig",o.datatableConfig)("reload",o.reloadEvent)}},dependencies:[d.sg,d.O5,N.D,d.Ov]})}return n})();var D=r(4955),E=r(9155);let j=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[d.ez,c.u5,c.UX,f.Bz.forChild([{path:"",component:L},{path:":id",component:F}]),E.Z,D.m,g.Oz,g.XC,g.lQ,g.HK,v.ii.forChild()]})}return n})()}}]);